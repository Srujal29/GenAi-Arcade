<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>GEN AI ARCADE - MLSC VIT Pune</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --electric-blue: #00A3FF;
            --light-blue: #00ffff;
            --accent-white: #EFEFEF;
            --dark-bg: #0A0F1A;
            --card-bg: rgba(20, 28, 46, 0.8);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--accent-white);
            overflow: hidden;
            cursor: none;
        }

        #cursor-dot {
            width: 8px; height: 8px;
            background-color: var(--light-blue);
            border-radius: 50%; position: fixed;
            z-index: 9999; pointer-events: none;
            box-shadow: 0 0 10px var(--light-blue);
            transition: transform 0.1s ease-out;
            display: none;
        }
        @media (pointer: fine) {
            #cursor-dot { display: block; }
        }

        .ai-font {
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
            animation: text-flicker 3s linear infinite;
        }

        .neon-glow-blue {
            text-shadow: 0 0 4px var(--electric-blue), 0 0 8px var(--electric-blue);
        }

        @keyframes text-flicker {
            0% { opacity: 0.8; text-shadow: 0 0 6px var(--electric-blue); }
            5% { opacity: 0.5; } 10% { opacity: 0.9; } 20% { opacity: 0.6; }
            30% { opacity: 1; } 40% { opacity: 0.7; } 50% { opacity: 0.9; text-shadow: 0 0 10px var(--electric-blue); }
            60% { opacity: 0.6; } 70% { opacity: 1; } 80% { opacity: 0.5; } 100% { opacity: 0.9; }
        }

        .neon-btn {
            background-color: transparent; border: 2px solid var(--electric-blue);
            color: var(--electric-blue); box-shadow: 0 0 8px var(--electric-blue);
            transition: all 0.2s ease-in-out; font-weight: bold;
            position: relative; overflow: hidden;
        }
        .neon-btn:hover {
            background-color: var(--electric-blue); color: var(--dark-bg);
            box-shadow: 0 0 15px var(--electric-blue), 0 0 30px var(--electric-blue);
            transform: scale(1.05);
        }
        .neon-btn::before {
            content: attr(data-text); position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--dark-bg); color: var(--electric-blue);
            transform: translateX(-100%); transition: transform 0.3s ease;
            display: flex; align-items: center; justify-content: center;
        }
        .neon-btn:hover::before { transform: translateX(0); }
        
        .screen {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            padding: 1rem;
            transition: opacity 0.5s ease-in-out;
            visibility: hidden; opacity: 0;
        }
        .screen.active { visibility: visible; opacity: 1; }

        #gameCanvas {
            border: 2px solid var(--electric-blue);
            box-shadow: 0 0 15px var(--electric-blue); display: block;
            margin: 0 auto; max-width: 100%;
            touch-action: none; background-color: transparent;
        }
        
        .data-card {
            background-color: var(--card-bg); backdrop-filter: blur(8px);
            border: 1px solid rgba(0, 163, 255, 0.3);
        }

        .speaker-frame {
            border-radius: 50%; padding: 5px;
            background: linear-gradient(45deg, var(--dark-bg), #1E3A8A);
            box-shadow: 0 0 15px var(--electric-blue);
        }
        .speaker-frame img { border-radius: 50%; border: 2px solid var(--electric-blue); }

        #background-animation, #crt-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; z-index: -1;
            pointer-events: none;
        }

        #background-grid {
             position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; z-index: -2;
            pointer-events: none;
            background-image:
                linear-gradient(rgba(0, 163, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 163, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: pan-grid 30s linear infinite;
        }

        @keyframes pan-grid {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }


        #crt-overlay {
            background:
                radial-gradient(ellipse at center, rgba(0,0,0,0) 50%, rgba(0,0,0,0.5) 100%),
                repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.05) 0px, rgba(255, 255, 255, 0.05) 1px, transparent 1px, transparent 3px);
            animation: crt-flicker 0.1s infinite;
        }
        @keyframes crt-flicker {
            0% { opacity: 0.95; } 50% { opacity: 1; } 100% { opacity: 0.95; }
        }
        #app-container { perspective: 1000px; }
        #app-container-inner { transform: scale(1.05); border-radius: 20px; overflow: hidden; height: 100vh; }

        #boot-overlay {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background-color: var(--dark-bg);
            z-index: 10000; display: flex;
            align-items: center; justify-content: center;
            transition: opacity 1s ease-in-out;
        }
        #boot-text {
            font-family: 'Orbitron', monospace; color: var(--electric-blue);
            font-size: 1.5rem; text-shadow: 0 0 5px var(--electric-blue);
        }
        
        @media (max-width: 768px) {
            #app-container-inner { transform: scale(1); border-radius: 0; }
            body { cursor: default; }
            #cursor-dot { display: none; }
            .ai-font { letter-spacing: 1px; }
        }
    </style>
</head>
<body>

    <div id="cursor-dot"></div>
    <canvas id="background-animation"></canvas>
    <div id="background-grid"></div>
    <div id="crt-overlay"></div>

    <div id="boot-overlay">
        <p id="boot-text"></p>
    </div>

    <div id="app-container" class="w-full h-screen mx-auto">
        <div id="app-container-inner">
            <!-- Landing Page -->
            <section id="landing-screen" class="screen">
                <div class="text-center max-w-6xl w-full px-4 overflow-y-auto h-full">
                     <h2 class="gsap-reveal text-base md:text-lg text-gray-300 mt-20 md:mt-24">Microsoft Learn Student Chapter, VIT Pune Presents</h2>
                    <div id="main-title-wrapper" class="flex items-center justify-center my-4 gsap-reveal" style="transform-style: preserve-3d;">
                        <span class="text-3xl md:text-6xl ai-font text-[var(--electric-blue)] neon-glow-blue">&raquo;</span>
                        <h1 class="text-3xl md:text-6xl ai-font text-[var(--accent-white)] mx-2 md:mx-4">GEN AI ARCADE</h1>
                        <span class="text-3xl md:text-6xl ai-font text-[var(--electric-blue)] neon-glow-blue">&laquo;</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 my-8 items-center">
                        <div class="flex flex-col items-center gsap-reveal">
                            <p class="text-base md:text-xl text-gray-300 mb-4">Join us for an inspiring talk by a Google Speaker on the future of AI and its real-world impact.</p>
                            <div class="speaker-frame mb-4">
                                <img src="https://placehold.co/150x150/EFEFEF/333333?text=Aditya+Rane" alt="Aditya Rane" class="w-36 h-36">
                            </div>
                            <h3 class="text-2xl md:text-3xl font-bold text-[var(--accent-white)]">ADITYA RANE</h3>
                            <p class="text-lg text-[var(--electric-blue)]">AI Consultant @ Google</p>
                        </div>
                        <div class="text-left flex flex-col justify-center gsap-reveal">
                            <div class="p-6 rounded-lg data-card mb-6">
                                <h4 class="text-xl md:text-2xl font-bold text-[var(--electric-blue)] mb-4">Stay back for:</h4>
                                <ul class="space-y-2 text-sm md:text-base">
                                    <li class="flex items-center"><span class="text-[var(--electric-blue)] mr-2">&raquo;</span> Hands-on GenAI workshop</li>
                                    <li class="flex items-center"><span class="text-[var(--electric-blue)] mr-2">&raquo;</span> Explore tools & build AI-powered ideas</li>
                                     <li class="flex items-center"><span class="text-[var(--electric-blue)] mr-2">&raquo;</span> Experience creativity meeting technology!</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <button id="start-game-button" data-text="PLAY THE ARCADE CHALLENGE" class="neon-btn font-bold py-3 px-10 rounded-lg text-lg gsap-reveal mb-8">PLAY THE ARCADE CHALLENGE</button>
                </div>
            </section>

            <!-- Game Screen -->
            <section id="game-screen" class="screen">
                 <div class="flex flex-col items-center w-full h-full max-w-[800px]">
                    <h2 class="text-2xl md:text-4xl ai-font text-[var(--electric-blue)] my-2 text-center">DEFENSE PROTOCOL</h2>
                    <div class="flex flex-wrap justify-center gap-x-4 md:gap-x-6 gap-y-1 text-sm md:text-lg text-[var(--light-blue)] mb-2">
                        <span class="neon-glow-blue">Integrity: <span id="score">0</span></span>
                        <span class="neon-glow-blue">Target: <span id="target">100</span></span>
                        <span class="neon-glow-blue">Shields: <span id="lives">3</span></span>
                    </div>
                    <canvas id="gameCanvas" class="flex-grow w-full border-2 border-[var(--electric-blue)] shadow-[0_0_15px_var(--electric-blue)]"></canvas>
                </div>
            </section>

            <!-- Final Screen -->
            <section id="final-screen" class="screen">
                <div class="text-center max-w-3xl px-4">
                     <div id="final-icon" class="text-6xl mb-4"></div>
                    <h1 id="final-title" class="text-4xl md:text-7xl ai-font mb-6"></h1>
                    <p id="final-message" class="text-lg md:text-3xl text-gray-300 mb-10"></p>
                     
                     <div id="success-links" class="p-6 md:p-8 rounded-xl data-card">
                        <h3 class="text-xl md:text-2xl font-bold text-[var(--light-blue)] mb-6">Secure Your Spot:</h3>
                        <a href="https://chat.whatsapp.com/KfqHxXxOxjI26FsZf7SMmQ?mode=ems_copy_c" target="_blank" rel="noopener noreferrer" data-text="üì± Join WhatsApp Datafeed" class="block w-full font-bold mb-4 py-3 rounded-lg bg-transparent border-2 border-[var(--light-blue)] text-[var(--light-blue)] neon-btn">
                           <span class="relative z-10">üì± Join WhatsApp Datafeed</span> 
                        </a>
                        <a href="https://forms.gle/o2WQ6fdcZ7dtkgcWA" target="_blank" rel="noopener noreferrer" data-text="üìù Finalize System Registration" class="block w-full font-bold mb-6 py-3 rounded-lg bg-transparent border-2 border-[var(--accent-white)] text-[var(--accent-white)] neon-btn">
                            <span class="relative z-10">üìù Finalize System Registration</span>
                        </a>
                        <div class="text-lg text-gray-400 mt-6 mb-4">Connect with MLSC VIT Pune:</div>
                        <div class="flex justify-center space-x-6">
                            <!-- LinkedIn Icon -->
                            <a href="https://www.linkedin.com/company/mlsc-vitpune/" target="_blank" rel="noopener noreferrer" class="text-[var(--light-blue)] hover:text-white transition-colors duration-200">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.75s.784-1.75 1.75-1.75 1.75.79 1.75 1.75-.783 1.75-1.75 1.75zm13.5 12.268h-3v-5.604c0-3.368-4-3.518-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.376v6.859z"/></svg>
                            </a>
                            <!-- Instagram Icon -->
                            <a href="https://www.instagram.com/mlscvitpune?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" target="_blank" rel="noopener noreferrer" class="text-[var(--light-blue)] hover:text-white transition-colors duration-200">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2.163c3.204 0 3.584.012 4.85.07 1.266.058 2.164.24 2.885.513.733.27 1.34.61 1.947 1.217.605.607.945 1.214 1.217 1.947.273.72.455 1.62.513 2.885.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.058 1.266-.24 2.164-.513 2.885a4.912 4.912 0 01-1.217 1.947c-.607.605-1.214.945-1.947 1.217-.72.273-1.62.455-2.885.513-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.266-.058-2.164-.24-2.885-.513a4.912 4.912 0 01-1.947-1.217c-.605-.607-.945-1.214-1.217-1.947-.273-.72-.455-1.62-.513-2.885C2.175 15.584 2.163 15.204 2.163 12s.012-3.584.07-4.85c.058-1.266.24-2.164.513-2.885a4.912 4.912 0 011.217-1.947c.607-.605 1.214-.945 1.947-1.217.72-.273 1.62-.455 2.885-.513C8.416 2.175 8.796 2.163 12 2.163zm0 1.8a9.72 9.72 0 00-4.823.07c-1.16.053-1.842.23-2.33.412a3.09 3.09 0 00-1.22.82A3.09 3.09 0 002.81 6.48c-.182.488-.36.17-.412 2.33C2.34 9.973 2.328 10.33 2.328 12s.012 2.027.07 3.19c.053 1.16.23 1.842.412 2.33a3.09 3.09 0 00.82 1.22c.45.45.86.638 1.22.82.488.182 1.17.36 2.33.412 1.163.058 1.52.07 3.19.07s2.027-.012 3.19-.07c1.16-.053 1.842-.23 2.33-.412a3.09 3.09 0 001.22-.82c.45-.45.638-.86.82-1.22.182-.488.36-1.17.412-2.33.058-1.163.07-1.52.07-3.19s-.012-2.027-.07-3.19c-.053-1.16-.23-1.842-.412-2.33a3.09 3.09 0 00-.82-1.22c-.45-.45-.86-.638-1.22-.82-.488-.182-1.17-.36-2.33-.412C14.027 3.975 13.67 3.963 12 3.963zM12 8.25a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5zm0 1.8a1.95 1.95 0 110 3.9 1.95 1.95 0 010-3.9zm4.5-3.6a.9.9 0 100 1.8.9.9 0 000-1.8z" clip-rule="evenodd"/></svg>
                            </a>
                            <!-- Website Icon -->
                            <a href="https://mlsc-vit-pune.vercel.app/" target="_blank" rel="noopener noreferrer" class="text-[var(--light-blue)] hover:text-white transition-colors duration-200">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.41 9a9.002 9.002 0 0110.43-6.52M20.59 15a9.002 9.002 0 01-10.43 6.52M12 2v20"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14"></path></svg>
                            </a>
                        </div>
                    </div>
                    <div id="retry-container" class="mt-8">
                        <button id="retry-button" data-text="RETRY CHALLENGE" class="neon-btn font-bold py-3 px-10 rounded-lg text-lg">RETRY CHALLENGE</button>
                   </div>
                </div>
            </section>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const CONFIG = {
            TARGET_SCORE: 100, PLAYER_LIVES: 3, ENEMY_SPAWN_RATE: 75,
            POINTS_PER_ENEMY: 100, PARTICLE_COUNT: 25, PARTICLE_LIFESPAN: 60,
            SHAKE_DURATION: 10, SHAKE_MAGNITUDE: 4, STAR_COUNT: 200,
            BG_PARTICLE_DENSITY: 12000, MOUSE_INTERACTION_RADIUS: 150,
            POWERUP_CHANCE: 0.1, // 10% chance
        };

        const screens = { boot: document.getElementById('boot-overlay'), landing: document.getElementById('landing-screen'), game: document.getElementById('game-screen'), final: document.getElementById('final-screen') };
        const gameCanvas = document.getElementById('gameCanvas'), ctx = gameCanvas.getContext('2d');
        const bgCanvas = document.getElementById('background-animation'), bgCtx = bgCanvas.getContext('2d');
        const cursorDot = document.getElementById('cursor-dot');
        let gameActive = false, keys = {}, mouse = { x: 0, y: 0 }, bgParticles = [], game = {}, gameLoopId;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type = 'sine', duration = 0.1, volume = 0.2) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode); gainNode.connect(audioCtx.destination);
            oscillator.type = type; oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            oscillator.start(audioCtx.currentTime); oscillator.stop(audioCtx.currentTime + duration);
        };

        function runBootSequence() {
            const bootTextEl = document.getElementById('boot-text');
            const lines = ["INITIALIZING...", "LOADING PROTOCOLS...", "CALIBRATING...", "SYSTEM ONLINE."];
            let lineIndex = 0, charIndex = 0;
            const type = () => {
                if (lineIndex >= lines.length) {
                    gsap.to(screens.boot, { opacity: 0, duration: 1, onComplete: () => { screens.boot.style.display = 'none'; showScreen('landing'); } });
                    return;
                }
                if (charIndex < lines[lineIndex].length) {
                    bootTextEl.textContent += lines[lineIndex].charAt(charIndex++);
                    playSound(800 + Math.random() * 200, 'square', 0.02);
                    setTimeout(type, 50);
                } else {
                    playSound(1200, 'sine', 0.1);
                    setTimeout(() => { lineIndex++; charIndex = 0; bootTextEl.textContent = ''; type(); }, 500);
                }
            };
            type();
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[screenName].classList.add('active');

            if (screenName === 'landing') {
                gsap.from(".gsap-reveal", { y: 50, opacity: 0, duration: 0.8, stagger: 0.15, ease: "power3.out", clearProps: "all" });
            }
            if (screenName === 'game') initGame();
        }

        function initBackground() {
            bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight;
            bgParticles = [];
            const num = (bgCanvas.height * bgCanvas.width) / CONFIG.BG_PARTICLE_DENSITY;
            for (let i = 0; i < num; i++) {
                const size = (Math.random() * 1.5) + 1;
                bgParticles.push({
                    x: Math.random() * innerWidth, y: Math.random() * innerHeight,
                    directionX: (Math.random() * 0.4) - 0.2, directionY: (Math.random() * 0.4) - 0.2,
                    size, baseSize: size
                });
            }
        }
        function animateBackground() {
            bgCtx.clearRect(0, 0, innerWidth, innerHeight);
            bgParticles.forEach(p => {
                const dx = mouse.x - p.x; const dy = mouse.y - p.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < CONFIG.MOUSE_INTERACTION_RADIUS) {
                    p.size = p.baseSize + (CONFIG.MOUSE_INTERACTION_RADIUS - distance) / 20;
                    p.x -= p.directionX * 2; p.y -= p.directionY * 2;
                } else {
                    p.size = p.baseSize; p.x += p.directionX; p.y += p.directionY;
                }
                if (p.x > innerWidth || p.x < 0) p.directionX *= -1;
                if (p.y > innerHeight || p.y < 0) p.directionY *= -1;
                bgCtx.beginPath(); bgCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                bgCtx.fillStyle = distance < CONFIG.MOUSE_INTERACTION_RADIUS ? 'rgba(0, 255, 255, 0.8)' : 'rgba(0, 163, 255, 0.5)';
                bgCtx.fill();
            });
            connectParticles();
            requestAnimationFrame(animateBackground);
        }
        function connectParticles() {
            for (let a = 0; a < bgParticles.length; a++) {
                for (let b = a; b < bgParticles.length; b++) {
                    const pa = bgParticles[a]; const pb = bgParticles[b];
                    const distance = ((pa.x - pb.x) ** 2) + ((pa.y - pb.y) ** 2);
                    const maxDistance = (innerWidth / 8) * (innerHeight / 8);
                    if (distance < maxDistance) {
                        const opacity = 1 - (distance / 20000);
                        const distA = ((pa.x - mouse.x) ** 2) + ((pa.y - mouse.y) ** 2);
                        const distB = ((pb.x - mouse.x) ** 2) + ((pb.y - mouse.y) ** 2);
                        let color = `rgba(0, 163, 255, ${opacity})`;
                        if (distA < CONFIG.MOUSE_INTERACTION_RADIUS ** 2 || distB < CONFIG.MOUSE_INTERACTION_RADIUS ** 2) {
                            color = `rgba(0, 255, 255, ${opacity * 2})`;
                        }
                        bgCtx.strokeStyle = color; bgCtx.lineWidth = 1;
                        bgCtx.beginPath(); bgCtx.moveTo(pa.x, pa.y); bgCtx.lineTo(pb.x, pb.y); bgCtx.stroke();
                    }
                }
            }
        }
        
        function shoot() {
            if (!gameActive || !game.player) return;
            if (game.player.shootCooldown === 0) {
                playSound(440, 'triangle', 0.08);
                game.projectiles.push({ width: 4, height: 15, x: game.player.x + game.player.width / 2 - 2, y: game.player.y, speed: 10, color: 'var(--accent-white)' });
                game.player.shootCooldown = 12;
            }
        }

        function initGame() {
            gameActive = true;
            game = {
                player: null, projectiles: [], enemies: [], particles: [], stars: [], powerups: [],
                shake: { duration: 0, magnitude: 0 },
                enemySpawnTimer: CONFIG.ENEMY_SPAWN_RATE,
                score: 0, lives: CONFIG.PLAYER_LIVES,
            };
            resizeGameCanvas();
            game.player = { width: 40, height: 20, x: gameCanvas.width / 2 - 20, y: gameCanvas.height - 40, speed: 8, color: 'var(--light-blue)', shootCooldown: 0 };
            game.stars = Array.from({ length: CONFIG.STAR_COUNT }, () => ({ x: Math.random() * gameCanvas.width, y: Math.random() * gameCanvas.height, size: Math.random() * 1.5 + 0.5, speed: (Math.random() * 1.5 + 0.5) * 0.5 }));
            
            const playerStartY = game.player.y;
            game.player.y = gameCanvas.height + 50;
            gsap.to(game.player, { y: playerStartY, duration: 1, ease: 'power3.out' });

            if (gameLoopId) cancelAnimationFrame(gameLoopId);
            gameLoop();
        }
        function gameLoop() {
            if (!gameActive) return;
            const g = game;
            g.frame = (g.frame || 0) + 1;
            if (keys['ArrowLeft'] && g.player.x > 0) g.player.x -= g.player.speed;
            if (keys['ArrowRight'] && g.player.x < gameCanvas.width - g.player.width) g.player.x += g.player.speed;
            if (g.player.shootCooldown > 0) g.player.shootCooldown--;
            
            g.enemySpawnTimer--;
            if (g.enemySpawnTimer <= 0) {
                g.enemies.push({ width: 30, height: 30, x: Math.random() * (gameCanvas.width - 30), y: -30, speed: Math.random() * 2 + 2, color: 'var(--electric-blue)', spawnTimer: 5 });
                g.enemySpawnTimer = CONFIG.ENEMY_SPAWN_RATE;
            }
            g.projectiles.forEach(p => p.y -= p.speed);
            g.enemies.forEach(e => e.y += e.speed);
            g.stars.forEach(s => { s.y += s.speed; if (s.y > gameCanvas.height) { s.y = 0; s.x = Math.random() * gameCanvas.width; } });
            g.particles.forEach(p => { p.x += p.vx; p.y += p.vy; p.vy += 0.05; p.life--; });
            g.powerups.forEach(p => { p.y += 2; p.life--; });
            
            handleCollisions();
            
            ctx.save();
            if (g.shake.duration > 0) { ctx.translate((Math.random() - 0.5) * g.shake.magnitude, (Math.random() - 0.5) * g.shake.magnitude); g.shake.duration--; }
            ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
            
            drawGameObjects();
            
            ctx.restore();
            
            updateGameUI();
            
            if (g.score >= CONFIG.TARGET_SCORE) endGame(true);
            if (g.lives <= 0) endGame(false);
            
            gameLoopId = requestAnimationFrame(gameLoop);
        }
        function handleCollisions() {
            const g = game;
            for (let i = g.projectiles.length - 1; i >= 0; i--) {
                for (let j = g.enemies.length - 1; j >= 0; j--) {
                    const p = g.projectiles[i]; const e = g.enemies[j];
                    if (p && e && e.spawnTimer <= 0 && p.x < e.x + e.width && p.x + p.width > e.x && p.y < e.y + e.height && p.y + p.height > e.y) {
                        playSound(200, 'square', 0.05);
                        for (let k = 0; k < CONFIG.PARTICLE_COUNT; k++) {
                            const angle = Math.random() * Math.PI * 2, speed = Math.random() * 5 + 2;
                            g.particles.push({ x: e.x + 15, y: e.y + 15, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, life: CONFIG.PARTICLE_LIFESPAN, color: e.color });
                        }
                        if (Math.random() < CONFIG.POWERUP_CHANCE) {
                            g.powerups.push({ x: e.x + 15, y: e.y + 15, size: 10, life: 300 });
                        }
                        g.shake = { duration: CONFIG.SHAKE_DURATION, magnitude: CONFIG.SHAKE_MAGNITUDE };
                        g.projectiles.splice(i, 1); g.enemies.splice(j, 1); g.score += CONFIG.POINTS_PER_ENEMY; break;
                    }
                }
            }
            for (let i = g.enemies.length - 1; i >= 0; i--) {
                const e = g.enemies[i];
                if (e.spawnTimer <= 0 && ((e.x < g.player.x + g.player.width && e.x + e.width > g.player.x && e.y < g.player.y + g.player.height && e.y + e.height > g.player.y) || e.y > gameCanvas.height)) {
                    playSound(150, 'sawtooth', 0.2);
                    g.particles.push({ x: g.player.x + g.player.width / 2, y: g.player.y + g.player.height / 2, isShieldHit: true, life: 20 });
                    g.enemies.splice(i, 1); g.lives--; g.shake = { duration: 15, magnitude: 8 };
                }
            }
            g.projectiles = g.projectiles.filter(p => p.y > -p.height);
            g.particles = g.particles.filter(p => p.life > 0);
            g.powerups = g.powerups.filter(p => p.y < gameCanvas.height && p.life > 0);
        }
        function drawGameObjects() {
            const g = game;
            g.stars.forEach(s => { ctx.fillStyle = 'rgba(239, 239, 239, 0.7)'; ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2); ctx.fill(); });
            
            const p = g.player;
            ctx.fillStyle = `rgba(0, 255, 255, ${Math.random() * 0.5 + 0.5})`;
            const tH = 15 + Math.random() * 10;
            ctx.beginPath(); ctx.moveTo(p.x + p.width * 0.2, p.y + p.height); ctx.lineTo(p.x + p.width / 2, p.y + p.height + tH); ctx.lineTo(p.x + p.width * 0.8, p.y + p.height); ctx.closePath(); ctx.fill();
            ctx.fillStyle = p.color; ctx.shadowColor = p.color; ctx.shadowBlur = 15;
            ctx.beginPath(); ctx.moveTo(p.x, p.y + p.height); ctx.lineTo(p.x + p.width / 2, p.y); ctx.lineTo(p.x + p.width, p.y + p.height); ctx.closePath(); ctx.fill();
            ctx.shadowBlur = 0;
            
            g.projectiles.forEach(pr => { ctx.fillStyle = pr.color; ctx.shadowColor = pr.color; ctx.shadowBlur = 10; ctx.fillRect(pr.x, pr.y, pr.width, pr.height); ctx.shadowBlur = 0;});
            
            g.enemies.forEach(e => {
                if (e.spawnTimer > 0) {
                    ctx.save(); ctx.translate(e.x + (Math.random() - 0.5) * 10, e.y + (Math.random() - 0.5) * 10);
                    ctx.fillStyle = ['#00A3FF', '#EFEFEF', '#00ffff'][Math.floor(Math.random()*3)]; ctx.shadowColor = e.color; ctx.shadowBlur = 20;
                    ctx.fillRect(0, 0, e.width, e.height); ctx.restore(); e.spawnTimer--;
                } else {
                    ctx.fillStyle = e.color; ctx.shadowColor = e.color; ctx.shadowBlur = 15; ctx.beginPath();
                    ctx.moveTo(e.x + 15, e.y); ctx.lineTo(e.x + 30, e.y + 15); ctx.lineTo(e.x + 15, e.y + 30); ctx.lineTo(e.x, e.y + 15);
                    ctx.closePath(); ctx.fill(); ctx.shadowBlur = 0;
                }
            });

            g.powerups.forEach(p => {
                const frame = g.frame || 0;
                ctx.fillStyle = `hsl(${ (frame % 360) }, 100%, 75%)`;
                ctx.shadowColor = `hsl(${ (frame % 360) }, 100%, 75%)`;
                ctx.shadowBlur = 20;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
                ctx.shadowBlur = 0;
            });
            
            g.particles.forEach(p => {
                if(p.isShieldHit) {
                    ctx.strokeStyle = 'rgba(255, 0, 100, 0.8)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 20 + (20 - p.life), 0, Math.PI * 2);
                    ctx.stroke();
                } else {
                    ctx.globalAlpha = Math.max(0, p.life / CONFIG.PARTICLE_LIFESPAN); ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI * 2); ctx.fill();
                }
            });
            ctx.globalAlpha = 1;
        }
        
        function updateGameUI() {
            document.getElementById('score').textContent = game.score;
            document.getElementById('lives').textContent = game.lives;
        }
        
        function endGame(success) {
            gameActive = false; cancelAnimationFrame(gameLoopId);
            playSound(success ? 1000 : 100, 'sine', 0.5);
            
            const finalIcon = document.getElementById('final-icon');
            const finalTitle = document.getElementById('final-title');
            const finalMessage = document.getElementById('final-message');
            const successLinks = document.getElementById('success-links');
            const retryContainer = document.getElementById('retry-container');
            
            if (success) {
                finalIcon.textContent = '‚úÖ';
                finalTitle.textContent = 'CHALLENGE COMPLETE!';
                finalTitle.className = `text-4xl md:text-7xl ai-font mb-6 text-[var(--light-blue)]`;
                finalMessage.textContent = 'System integrity restored. You have unlocked the secure data streams.';
                successLinks.style.display = 'block';
                retryContainer.style.display = 'none';
            } else {
                finalIcon.textContent = '‚ùå';
                finalTitle.textContent = 'SYSTEM BREACHED!';
                finalTitle.className = `text-4xl md:text-7xl ai-font mb-6 text-red-500`;
                finalMessage.textContent = 'Neural defense failed. One more try?';
                successLinks.style.display = 'none';
                retryContainer.style.display = 'block';
            }
            
            showScreen('final');
            gsap.from("#final-screen > div > *", { scale: 0.8, opacity: 0, duration: 0.5, stagger: 0.2, ease: "back.out(1.7)" });
        }
        
        function resizeGameCanvas() {
            const parent = gameCanvas.parentElement;
            const size = Math.min(parent.clientWidth, 800);
            gameCanvas.width = size;
            gameCanvas.height = size * 0.75;
            if(game.player) {
                game.player.y = gameCanvas.height - game.player.height - 20;
            }
        }

        // --- EVENT LISTENERS ---
        document.getElementById('start-game-button').addEventListener('click', () => {
            playSound(800, 'sawtooth', 0.2);
            showScreen('game');
        });

        document.getElementById('retry-button').addEventListener('click', () => {
            playSound(800, 'sawtooth', 0.2);
            showScreen('game');
        });
        
        document.querySelectorAll('.neon-btn').forEach(btn => {
            btn.addEventListener('mouseenter', () => playSound(600, 'square', 0.05));
        });

        window.addEventListener('keydown', e => { 
            keys[e.code] = true; 
            if(e.code === 'Space') shoot();
        });
        window.addEventListener('keyup', e => { keys[e.code] = false; });
        
        const titleWrapper = document.getElementById('main-title-wrapper');
        window.addEventListener('mousemove', e => {
            mouse.x = e.clientX; mouse.y = e.clientY;
            gsap.to(cursorDot, { x: e.clientX - 4, y: e.clientY - 4, duration: 0.1 });

            const { clientWidth, clientHeight } = document.documentElement;
            const xPercent = (e.clientX / clientWidth - 0.5) * 2;
            const yPercent = (e.clientY / clientHeight - 0.5) * 2;
            gsap.to(titleWrapper, {
                rotationY: xPercent * 10,
                rotationX: -yPercent * 10,
                ease: 'power1.out',
                duration: 0.5
            });
        });
        window.addEventListener('resize', () => { initBackground(); if(gameActive) resizeGameCanvas(); });
        
        gameCanvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            shoot();
        }, { passive: false });
        
        gameCanvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (gameActive && e.touches.length > 0 && game.player) {
                const rect = gameCanvas.getBoundingClientRect();
                let touchX = e.touches[0].clientX - rect.left;
                game.player.x = touchX - game.player.width / 2;
            }
        }, { passive: false });

        // --- INITIAL LOAD ---
        initBackground();
        animateBackground();
        runBootSequence();
        gsap.to("#app-container-inner", { scale: 1, duration: 2, ease: "elastic.out(1, 0.5)" });
    });
    </script>
</body>
</html>


